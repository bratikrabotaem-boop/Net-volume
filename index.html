<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">

<!-- КРИТИЧНО: полностью запрещаем браузерный zoom -->
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<title>BTC-USDT · Net Volume</title>

<script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>

<style>
body {
  margin: 0;
  background: #121417;
  color: #e6e6e6;
  font-family: Arial, sans-serif;
}

.wrapper {
  max-width: 1100px;
  margin: 20px auto;
  padding: 0 10px;
}

/* КРИТИЧНО: отключаем ВСЕ touch-жесты браузера */
#price, #volume {
  touch-action: none !important;
}

#price { height: 420px; }
#volume { height: 140px; }
</style>
</head>

<body>

<div class="wrapper">
  <div id="price"></div>
  <div id="volume"></div>
</div>

<script>
/* ===== ЖЁСТКО БЛОКИРУЕМ iOS GESTURE API ===== */
['gesturestart','gesturechange','gestureend'].forEach(ev => {
  document.addEventListener(ev, e => e.preventDefault(), { passive:false });
});

/* ===== ОБЩИЕ НАСТРОЙКИ ===== */
const commonOpts = {
  layout: {
    background: { color:'#121417' },
    textColor:'#ccc'
  },
  grid: {
    vertLines:{ color:'#1e2228' },
    horzLines:{ color:'#1e2228' }
  },
  timeScale: {
    timeVisible:true
  },

  /* ОСТАВЛЯЕМ ТОЛЬКО PAN */
  handleScroll: {
    mouseWheel: false,
    pressedMouseMove: true,
    horzTouchDrag: true,
    vertTouchDrag: false
  },

  /* ПОЛНОСТЬЮ УБИРАЕМ SCALE */
  handleScale: {
    mouseWheel: false,
    axisPressedMouseMove: false
  }
};

/* ===== PRICE CHART ===== */
const priceChart = LightweightCharts.createChart(
  document.getElementById('price'),
  {
    ...commonOpts,
    rightPriceScale: { visible:false },
    leftPriceScale: { visible:false }
  }
);

const candles = priceChart.addCandlestickSeries({
  upColor:'#1fc77b',
  downColor:'#e04b4b',
  borderUpColor:'#1fc77b',
  borderDownColor:'#e04b4b',
  wickUpColor:'#1fc77b',
  wickDownColor:'#e04b4b'
});

/* ===== VOLUME CHART ===== */
const volumeChart = LightweightCharts.createChart(
  document.getElementById('volume'),
  {
    ...commonOpts,
    rightPriceScale: { visible:false },
    leftPriceScale: { visible:false }
  }
);

const volume = volumeChart.addHistogramSeries({
  base: 0,
  priceFormat:{ type:'volume' }
});

/* ===== SYNC TIME ===== */
priceChart.timeScale().subscribeVisibleTimeRangeChange(r=>{
  volumeChart.timeScale().setVisibleRange(r);
});
volumeChart.timeScale().subscribeVisibleTimeRangeChange(r=>{
  priceChart.timeScale().setVisibleRange(r);
});

/* ===== DATA ===== */
async function loadData() {
  const r = await fetch(
    'https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1h&limit=300'
  );
  const d = await r.json();

  const c=[], v=[];
  const tzOffset = -new Date().getTimezoneOffset() * 60;

  d.forEach(k=>{
    const t = k[0]/1000 + tzOffset;

    c.push({
      time:t,
      open:+k[1],
      high:+k[2],
      low:+k[3],
      close:+k[4]
    });

    const net = 2*k[10]-k[7];
    v.push({
      time:t,
      value: net/1e6,
      color: net>=0 ? '#1fc77b' : '#e04b4b'
    });
  });

  candles.setData(c);
  volume.setData(v);

  priceChart.timeScale().fitContent();
  volumeChart.timeScale().fitContent();
}

loadData();
</script>
</body>
</html>
