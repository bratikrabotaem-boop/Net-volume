<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>BTCUSDT Â· Candles + Net Volume</title>

<!-- TradingView Lightweight Charts -->
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

<style>
body {
  margin: 0;
  background: #0f1115;
  color: #e6e6e6;
  font-family: Arial, sans-serif;
}

.wrapper {
  max-width: 1200px;
  margin: 20px auto;
}

#price {
  height: 380px;
}

#volume {
  height: 180px;
}
</style>
</head>

<body>
<div class="wrapper">
  <div id="price"></div>
  <div id="volume"></div>
</div>

<script>
const SYMBOL = 'BTCUSDT';
const INTERVAL = '5m';
const LIMIT = 300;

/* ---------- PRICE CHART ---------- */

const priceChart = LightweightCharts.createChart(
  document.getElementById('price'),
  {
    layout: {
      background: { color: '#0f1115' },
      textColor: '#aaa'
    },
    grid: {
      vertLines: { color: '#1c1f26' },
      horzLines: { color: '#1c1f26' }
    },
    rightPriceScale: {
      borderColor: '#333'
    },
    timeScale: {
      borderColor: '#333',
      timeVisible: true,
      secondsVisible: false
    }
  }
);

const candleSeries = priceChart.addCandlestickSeries({
  upColor: '#1fc77b',
  downColor: '#e04b4b',
  wickUpColor: '#1fc77b',
  wickDownColor: '#e04b4b',
  borderVisible: false
});

/* ---------- VOLUME CHART ---------- */

const volumeChart = LightweightCharts.createChart(
  document.getElementById('volume'),
  {
    layout: {
      background: { color: '#0f1115' },
      textColor: '#aaa'
    },
    grid: {
      vertLines: { color: '#1c1f26' },
      horzLines: { color: '#1c1f26' }
    },
    rightPriceScale: {
      borderColor: '#333'
    },
    timeScale: {
      visible: false
    }
  }
);

const volumeSeries = volumeChart.addHistogramSeries({
  priceFormat: {
    type: 'volume'
  },
  priceScaleId: ''
});

/* ---------- SYNC TIME SCALE ---------- */

priceChart.timeScale().subscribeVisibleTimeRangeChange(range => {
  volumeChart.timeScale().setVisibleRange(range);
});

/* ---------- LOAD BINANCE DATA ---------- */

async function loadData() {
  const res = await fetch(
    `https://api.binance.com/api/v3/klines?symbol=${SYMBOL}&interval=${INTERVAL}&limit=${LIMIT}`
  );
  const data = await res.json();

  const candles = [];
  const volumes = [];

  data.forEach(k => {
    const time = k[0] / 1000;

    const open = +k[1];
    const high = +k[2];
    const low  = +k[3];
    const close= +k[4];

    candles.push({
      time,
      open,
      high,
      low,
      close
    });

    const quote = +k[7];
    const buy = +k[10];
    const net = 2 * buy - quote;

    volumes.push({
      time,
      value: Math.abs(net),
      color: net >= 0 ? '#1fc77b' : '#e04b4b'
    });
  });

  candleSeries.setData(candles);
  volumeSeries.setData(volumes);

  priceChart.timeScale().fitContent();
}

loadData();
</script>
</body>
</html>
