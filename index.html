<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>BTC-USDT · Net Volume</title>

<script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>

<style>
body {
  margin: 0;
  background: #121417;
  color: #e6e6e6;
  font-family: Arial, sans-serif;

  /* ПОЛНЫЙ ЗАПРЕТ touch */
  touch-action: none;
  overscroll-behavior: none;
}

.wrapper {
  max-width: 1100px;
  margin: 20px auto;
  padding: 0 10px;
}

#price,
#volume {
  height: auto;
  touch-action: none;
  user-select: none;
  -webkit-user-select: none;
  overscroll-behavior: none;
}

#price { height: 420px; }
#volume { height: 140px; }

.title { text-align:center; font-size:18px; margin-bottom:4px; }
.sub { text-align:center; font-size:13px; color:#8a8a8a; margin-bottom:8px; }

.tf-buttons {
  display:flex; justify-content:center; gap:8px; margin-bottom:8px;
}
.tf-buttons button {
  background:#2a2d33; border:0; color:#ccc;
  padding:5px 10px; border-radius:4px; font-size:12px;
}
.tf-buttons button.active { background:#3f434b; color:#fff; }
</style>
</head>

<body>
<div class="wrapper">
  <div class="title">BTC-USDT · NET VOLUME</div>
  <div class="sub">BINANCE</div>

  <div class="tf-buttons">
    <button onclick="setTF('1d')">1D</button>
    <button onclick="setTF('4h')">4H</button>
    <button onclick="setTF('1h')" class="active">1H</button>
    <button onclick="setTF('30m')">30M</button>
    <button onclick="setTF('15m')">15M</button>
    <button onclick="setTF('5m')">5M</button>
  </div>

  <div id="price"></div>
  <div id="volume"></div>
</div>

<script>
/* ===== ПОЛНЫЙ БЛОК touch/gesture ===== */
['touchstart','touchmove','touchend','touchcancel',
 'gesturestart','gesturechange','gestureend']
.forEach(ev => {
  document.addEventListener(ev, e => e.preventDefault(), { passive:false });
});

let INTERVAL = '1h';

const commonOpts = {
  layout: { background:{color:'#121417'}, textColor:'#ccc' },
  grid: { vertLines:{color:'#1e2228'}, horzLines:{color:'#1e2228'} },
  timeScale: { timeVisible:true },

  handleScroll: {
    horzTouchDrag: false,   // touch ВЫКЛ
    vertTouchDrag: false,
    pressedMouseMove: true,
    mouseWheel: false,
  },
  handleScale: {
    pinch: false,
    axisPressedMouseMove: false,
    mouseWheel: false,
  }
};

// PRICE
const priceChart = LightweightCharts.createChart(
  document.getElementById('price'),
  {
    ...commonOpts,
    rightPriceScale:{visible:false},
    leftPriceScale:{visible:false}
  }
);
const candles = priceChart.addCandlestickSeries();

// VOLUME
const volumeChart = LightweightCharts.createChart(
  document.getElementById('volume'),
  {
    ...commonOpts,
    rightPriceScale:{visible:false},
    leftPriceScale:{visible:false}
  }
);
const volume = volumeChart.addHistogramSeries({ base:0 });

// SYNC
priceChart.timeScale().subscribeVisibleTimeRangeChange(r=>{
  volumeChart.timeScale().setVisibleRange(r);
});
volumeChart.timeScale().subscribeVisibleTimeRangeChange(r=>{
  priceChart.timeScale().setVisibleRange(r);
});

// DATA
async function loadData() {
  const r = await fetch(
    `https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=${INTERVAL}&limit=500`
  );
  const d = await r.json();

  const c=[], v=[];
  const tzOffset = -new Date().getTimezoneOffset() * 60;

  d.forEach(k=>{
    const t = k[0]/1000 + tzOffset;
    c.push({ time:t, open:+k[1], high:+k[2], low:+k[3], close:+k[4] });

    const net = 2*k[10]-k[7];
    v.push({ time:t, value: net/1e6, color: net>=0?'#1fc77b':'#e04b4b' });
  });

  candles.setData(c);
  volume.setData(v);
  priceChart.timeScale().fitContent();
  volumeChart.timeScale().fitContent();
}

function setTF(tf){
  INTERVAL=tf;
  document.querySelectorAll('.tf-buttons button')
    .forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  loadData();
}

loadData();
</script>
</body>
</html>
