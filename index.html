<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BTC-USDT 路 Net Volume</title>

<script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>

<style>
body {
  margin: 0;
  background: #121417;
  color: #e6e6e6;
  font-family: Arial, sans-serif;
}
.wrapper {
  max-width: 1100px;
  margin: 20px auto;
  padding: 0 10px;
}
.title { text-align:center; font-size:18px; margin-bottom:4px; }
.sub { text-align:center; font-size:13px; color:#8a8a8a; margin-bottom:8px; }

.tf-buttons {
  display:flex; justify-content:center; gap:8px; margin-bottom:8px;
}
.tf-buttons button {
  background:#2a2d33; border:0; color:#ccc;
  padding:5px 10px; border-radius:4px; font-size:12px;
  cursor:pointer;
}
.tf-buttons button.active { background:#3f434b; color:#fff; }

#price { height: 420px; }
#volume { height: 140px; }
</style>
</head>

<body>
<div class="wrapper">
  <div class="title">BTC-USDT 路 NET VOLUME</div>
  <div class="sub">BINANCE</div>

  <div class="tf-buttons">
    <button onclick="setTF('1d')">1D</button>
    <button onclick="setTF('4h')">4H</button>
    <button onclick="setTF('1h')" class="active">1H</button>
    <button onclick="setTF('30m')">30M</button>
    <button onclick="setTF('15m')">15M</button>
    <button onclick="setTF('5m')">5M</button>
  </div>

  <div id="price"></div>
  <div id="volume"></div>
</div>

<script>
let INTERVAL = '1h';
const SCALE_WIDTH = 55;

const commonOpts = {
  layout: { background:{color:'#121417'}, textColor:'#ccc' },
  grid: { vertLines:{color:'#1e2228'}, horzLines:{color:'#1e2228'} },
  timeScale: { timeVisible:true }
};

// ===== PRICE CHART =====
const priceChart = LightweightCharts.createChart(
  document.getElementById('price'),
  {
    ...commonOpts,
    rightPriceScale: {
      visible:true,
      borderColor:'#1e2228',
      minimumWidth: SCALE_WIDTH
    },
    leftPriceScale: { visible:false }
  }
);

//  : priceFormat 孝小携 小鞋
const candles = priceChart.addCandlestickSeries({
  upColor:'#1fc77b',
  downColor:'#e04b4b',
  borderUpColor:'#1fc77b',
  borderDownColor:'#e04b4b',
  wickUpColor:'#1fc77b',
  wickDownColor:'#e04b4b',

  // 猬锔 校孝 .00
  priceFormat: {
    type: 'custom',
    formatter: v => Math.round(v).toString()
  }
});

// ===== VOLUME CHART =====
const volumeChart = LightweightCharts.createChart(
  document.getElementById('volume'),
  {
    ...commonOpts,
    rightPriceScale: {
      visible:true,
      borderColor:'#1e2228',
      minimumWidth: SCALE_WIDTH
    },
    leftPriceScale: { visible:false }
  }
);

const volume = volumeChart.addHistogramSeries({
  base: 0,
  priceFormat:{ type:'volume' }
});

// ===== SYNC TIME =====
priceChart.timeScale().subscribeVisibleTimeRangeChange(range=>{
  volumeChart.timeScale().setVisibleRange(range);
});
volumeChart.timeScale().subscribeVisibleTimeRangeChange(range=>{
  priceChart.timeScale().setVisibleRange(range);
});

// ===== DATA =====
async function loadData() {
  const r = await fetch(
    `https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=${INTERVAL}&limit=500`
  );
  const d = await r.json();

  const c=[], v=[];
  d.forEach(k=>{
    const t = k[0]/1000;

    c.push({
      time:t,
      open:+k[1],
      high:+k[2],
      low:+k[3],
      close:+k[4]
    });

    const net = 2*k[10]-k[7];
    v.push({
      time:t,
      value: net/1e6,
      color: net>=0 ? '#1fc77b' : '#e04b4b'
    });
  });

  candles.setData(c);
  volume.setData(v);
  priceChart.timeScale().fitContent();
  volumeChart.timeScale().fitContent();
}

function setTF(tf){
  INTERVAL=tf;
  document.querySelectorAll('.tf-buttons button')
    .forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  loadData();
}

loadData();
</script>
</body>
</html>
